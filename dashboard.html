<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - RenewPoly</title>
  <link rel="stylesheet" href="dashboard.css">
  <!-- <script src="dashboard.js"></script> -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
  <header>
    <h1>RenewPoly Dashboard</h1>
  </header>

  <!-- Navigation Tabs -->
  <nav class="dashboard-nav">
    <button class="tab-btn active" data-report="buy-monthly">Monthly Buy</button>
    <button class="tab-btn" data-report="buy-ytd">YTD Buy</button>
    <button class="tab-btn" data-report="buy-full">Full Buy</button>
    <button class="tab-btn" data-report="sell-monthly">Monthly Sell</button>
    <button class="tab-btn" data-report="sell-ytd">YTD Sell</button>
    <button class="tab-btn" data-report="sell-full">Full Sell</button>
    <button class="tab-btn" data-report="expense-monthly">Monthly Expense</button>
    <button class="tab-btn" data-report="expense-ytd">YTD Expense</button>
    <button class="tab-btn" data-report="expense-full">Full Expense</button>
  </nav>

  <main class="dashboard-widgets">
    <!-- BUY Reports -->
    <div class="widget" id="buy-monthly">
      <h2>Monthly Buy Report</h2>
      <table>
        <thead>
          <tr>
            <th>Plastic Type</th>
            <th>Total Quantity</th>
            <th>Average Price</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="widget" id="buy-ytd">
      <h2>Year-to-Date Buy Report</h2>
      <table>
        <thead>
          <tr>
            <th>Month</th>
            <th>Plastic Type</th>
            <th>Total Quantity</th>
            <th>Average Price</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="widget" id="buy-full">
      <h2>Full Buy Report</h2>
      <table>
        <thead>
          <tr>
            <th>Year</th>
            <th>Month</th>
            <th>Plastic Type</th>
            <th>Total Quantity</th>
            <th>Average Price</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- SELL Reports -->
    <div class="widget" id="sell-monthly">
      <h2>Monthly Sell Report</h2>
      <table>
        <thead>
          <tr>
            <th>Plastic Type</th>
            <th>Total Quantity</th>
            <th>Average Price</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="widget" id="sell-ytd">
      <h2>YTD Sell Report</h2>
      <table>
        <thead>
          <tr>
            <th>Month</th>
            <th>Plastic Type</th>
            <th>Total Quantity</th>
            <th>Average Price</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="widget" id="sell-full">
      <h2>Full Sell Report</h2>
      <table>
        <thead>
          <tr>
            <th>Year</th>
            <th>Month</th>
            <th>Plastic Type</th>
            <th>Total Quantity</th>
            <th>Average Price</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- EXPENSE Reports -->
    <div class="widget" id="expense-monthly">
      <h2>Monthly Expense Report</h2>
      <table>
        <thead>
          <tr>
            <th>Expense Type</th>
            <th>Total Amount</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="widget" id="expense-ytd">
      <h2>YTD Expense Report</h2>
      <table>
        <thead>
          <tr>
            <th>Month</th>
            <th>Expense Type</th>
            <th>Total Amount</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="widget" id="expense-full">
      <h2>Full Expense Report</h2>
      <table>
        <thead>
          <tr>
            <th>Year</th>
            <th>Month</th>
            <th>Expense Type</th>
            <th>Total Amount</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </main>



  <!-- -------delete-------------- -->
  <div class="d">
  <button id="deleteAllBtn" class="delete-btn">
    <i class="fa fa-trash"></i> Delete All Data
  </button>
</div>



  
</body>
</html>





<!-- ---------------------------------------------------------------------------------------------------------- -->

<script>
  
document.addEventListener('DOMContentLoaded', () => {
  const tabs = document.querySelectorAll('.tab-btn');
  const widgets = document.querySelectorAll('.widget');

  // Show default widget
  widgets.forEach(w => (w.style.display = 'none'));
  const defaultWidget = document.getElementById('expense-monthly');
  if (defaultWidget) defaultWidget.style.display = 'block';

  // Tab click handler
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const reportId = tab.getAttribute('data-report');
      tabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      widgets.forEach(w => (w.style.display = 'none'));
      const widget = document.getElementById(reportId);
      if (widget) widget.style.display = 'block';
    });
  });

  // ✅ Helper to safely parse date
  function parseDate(dateStr) {
    // If already ISO
    if (/^\d{4}-\d{2}-\d{2}$/.test(dateStr)) {
      return new Date(dateStr);
    }
    // Try converting from DD/MM/YYYY to YYYY-MM-DD
    const parts = dateStr.split('/');
    if (parts.length === 3) {
      const [day, month, year] = parts;
      return new Date(`${year}-${month}-${day}`);
    }
    return new Date(dateStr);
  }

  function loadExpenses() {
    const expenses = JSON.parse(localStorage.getItem('expenses')) || [];

    // --- Monthly Report ---
    const monthlyTable = document.querySelector('#expense-monthly tbody');
    monthlyTable.innerHTML = '';
    const monthlyData = {};

    expenses.forEach(exp => {
      const date = parseDate(exp.expenseDate);
      if (isNaN(date)) return; // skip invalid

      const month = date.toLocaleString('default', { month: 'long', year: 'numeric' });
      const key = `${exp.expenseType}|${month}`;
      monthlyData[key] = (monthlyData[key] || 0) + parseFloat(exp.amount);
    });

    for (let key in monthlyData) {
      const [type, month] = key.split('|');
      const row = document.createElement('tr');
      row.innerHTML = `<td>${type}</td><td>${monthlyData[key].toFixed(2)}</td>`;
      monthlyTable.appendChild(row);
    }

    // --- YTD Report ---
    const ytdTable = document.querySelector('#expense-ytd tbody');
    ytdTable.innerHTML = '';
    const ytdData = {};

    expenses.forEach(exp => {
      const date = parseDate(exp.expenseDate);
      if (isNaN(date)) return;
      const year = date.getFullYear();
      const month = date.toLocaleString('default', { month: 'long' });
      const key = `${year}-${month}|${exp.expenseType}`;
      ytdData[key] = (ytdData[key] || 0) + parseFloat(exp.amount);
    });

    for (let key in ytdData) {
      const [ym, type] = key.split('|');
      const [year, month] = ym.split('-');
      const row = document.createElement('tr');
      row.innerHTML = `<td>${month}</td><td>${type}</td><td>${ytdData[key].toFixed(2)}</td>`;
      ytdTable.appendChild(row);
    }

    // --- Full Report ---
    const fullTable = document.querySelector('#expense-full tbody');
    fullTable.innerHTML = '';
    const fullData = {};

    expenses.forEach(exp => {
      const date = parseDate(exp.expenseDate);
      if (isNaN(date)) return;
      const year = date.getFullYear();
      const month = date.toLocaleString('default', { month: 'long' });
      const key = `${year}-${month}|${exp.expenseType}`;
      fullData[key] = (fullData[key] || 0) + parseFloat(exp.amount);
    });

    for (let key in fullData) {
      const [ym, type] = key.split('|');
      const [year, month] = ym.split('-');
      const row = document.createElement('tr');
      row.innerHTML = `<td>${year}</td><td>${month}</td><td>${type}</td><td>${fullData[key].toFixed(2)}</td>`;
      fullTable.appendChild(row);
    }
  }

  loadExpenses();
  window.addEventListener('storage', loadExpenses);
});




    // 🗑️ DELETE ALL DATA BUTTON
  const deleteBtn = document.getElementById('deleteAllBtn');
  deleteBtn.addEventListener('click', () => {
    const confirmDelete = confirm('Are you sure you want to delete ALL data from the dashboard?');
    if (confirmDelete) {
      // 1️⃣ Clear all localStorage data
      localStorage.clear();

      // 2️⃣ Clear all table bodies in dashboard
      const tables = document.querySelectorAll('table tbody');
      tables.forEach(tbody => {
        tbody.innerHTML = '';
      });

      alert('✅ All data has been deleted from dashboard.');
    }
  });




function renderBuyReports(){
  const transactions = JSON.parse(localStorage.getItem('buyingTransactions')||'[]');

  // --- Monthly Buy Report ---
  const monthlyTable = document.querySelector('#buy-monthly tbody');
  monthlyTable.innerHTML = '';
  const monthlyData = {};

  transactions.forEach(t=>{
    const month = new Date(t.buyingDate).toLocaleString('default',{month:'long', year:'numeric'});
    const key = `${t.plasticType}|${month}`;
    if(!monthlyData[key]) monthlyData[key] = {totalQty:0, totalPrice:0};
    monthlyData[key].totalQty += t.totalQty;
    monthlyData[key].totalPrice += t.price;
  });

  for(let key in monthlyData){
    const [plastic, month] = key.split('|');
    const avgPrice = monthlyData[key].totalPrice / monthlyData[key].totalQty;
    const row = `<tr><td>${plastic}</td><td>${monthlyData[key].totalQty.toFixed(2)}</td><td>${avgPrice.toFixed(2)}</td></tr>`;
    monthlyTable.innerHTML += row;
  }

  // --- YTD Buy Report ---
  const ytdTable = document.querySelector('#buy-ytd tbody');
  ytdTable.innerHTML = '';
  const ytdData = {};
  transactions.forEach(t=>{
    const date = new Date(t.buyingDate);
    const year = date.getFullYear();
    const month = date.toLocaleString('default',{month:'long'});
    const key = `${year}-${month}|${t.plasticType}`;
    if(!ytdData[key]) ytdData[key] = {totalQty:0, totalPrice:0};
    ytdData[key].totalQty += t.totalQty;
    ytdData[key].totalPrice += t.price;
  });

  for(let key in ytdData){
    const [ym, plastic] = key.split('|');
    const [year, month] = ym.split('-');
    const avgPrice = ytdData[key].totalPrice / ytdData[key].totalQty;
    const row = `<tr><td>${month}</td><td>${plastic}</td><td>${ytdData[key].totalQty.toFixed(2)}</td><td>${avgPrice.toFixed(2)}</td></tr>`;
    ytdTable.innerHTML += row;
  }

  // --- Full Buy Report ---
  const fullTable = document.querySelector('#buy-full tbody');
  fullTable.innerHTML = '';
  const fullData = {};
  transactions.forEach(t=>{
    const date = new Date(t.buyingDate);
    const year = date.getFullYear();
    const month = date.toLocaleString('default',{month:'long'});
    const key = `${year}-${month}|${t.plasticType}`;
    if(!fullData[key]) fullData[key] = {totalQty:0, totalPrice:0};
    fullData[key].totalQty += t.totalQty;
    fullData[key].totalPrice += t.price;
  });

  for(let key in fullData){
    const [ym, plastic] = key.split('|');
    const [year, month] = ym.split('-');
    const avgPrice = fullData[key].totalPrice / fullData[key].totalQty;
    const row = `<tr><td>${year}</td><td>${month}</td><td>${plastic}</td><td>${fullData[key].totalQty.toFixed(2)}</td><td>${avgPrice.toFixed(2)}</td></tr>`;
    fullTable.innerHTML += row;
  }
}

// Call render function when dashboard loads
renderBuyReports();

// Optional: update dashboard if Local Storage changes
window.addEventListener('storage', renderBuyReports);










document.addEventListener("DOMContentLoaded", () => {
  const transactions = JSON.parse(localStorage.getItem('sellingTransactions')) || [];

  const sellMonthlyTbody = document.querySelector("#sell-monthly tbody");
  const sellYtdTbody = document.querySelector("#sell-ytd tbody");
  const sellFullTbody = document.querySelector("#sell-full tbody");

  // Helper: Group by key
  function groupBy(array, keyFunc) {
    return array.reduce((result, item) => {
      const key = keyFunc(item);
      if (!result[key]) result[key] = [];
      result[key].push(item);
      return result;
    }, {});
  }

  // --- Monthly Sell Report (Total by Plastic Type) ---
  // Assuming you have "plasticType" in each transaction
  const monthlyGroups = groupBy(transactions, t => t.plasticType || 'Unknown');
  for (const [plasticType, items] of Object.entries(monthlyGroups)) {
    const totalQty = items.reduce((sum, i) => sum + i.soldQty, 0);
    const avgPrice = items.reduce((sum, i) => sum + i.soldPriceActual, 0) / items.length;
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${plasticType}</td><td>${totalQty}</td><td>${avgPrice.toFixed(2)}</td>`;
    sellMonthlyTbody.appendChild(tr);
  }

  // --- YTD Sell Report (Grouped by Month & Plastic Type) ---
  const currentYear = new Date().getFullYear();
  const ytdGroups = transactions
    .filter(t => new Date(t.sellingDate).getFullYear() === currentYear)
    .reduce((acc, t) => {
      const month = new Date(t.sellingDate).toLocaleString('default', { month: 'short' });
      const key = `${month}-${t.plasticType || 'Unknown'}`;
      if (!acc[key]) acc[key] = [];
      acc[key].push(t);
      return acc;
    }, {});

  for (const [key, items] of Object.entries(ytdGroups)) {
    const [month, plasticType] = key.split('-');
    const totalQty = items.reduce((sum, i) => sum + i.soldQty, 0);
    const avgPrice = items.reduce((sum, i) => sum + i.soldPriceActual, 0) / items.length;
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${month}</td><td>${plasticType}</td><td>${totalQty}</td><td>${avgPrice.toFixed(2)}</td>`;
    sellYtdTbody.appendChild(tr);
  }

  // --- Full Sell Report (Grouped by Year, Month & Plastic Type) ---
  const fullGroups = transactions.reduce((acc, t) => {
    const date = new Date(t.sellingDate);
    const year = date.getFullYear();
    const month = date.toLocaleString('default', { month: 'short' });
    const key = `${year}-${month}-${t.plasticType || 'Unknown'}`;
    if (!acc[key]) acc[key] = [];
    acc[key].push(t);
    return acc;
  }, {});

  for (const [key, items] of Object.entries(fullGroups)) {
    const [year, month, plasticType] = key.split('-');
    const totalQty = items.reduce((sum, i) => sum + i.soldQty, 0);
    const avgPrice = items.reduce((sum, i) => sum + i.soldPriceActual, 0) / items.length;
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${year}</td><td>${month}</td><td>${plasticType}</td><td>${totalQty}</td><td>${avgPrice.toFixed(2)}</td>`;
    sellFullTbody.appendChild(tr);
  }
});






  function renderSellReports() {
    const transactions = JSON.parse(localStorage.getItem('sellingTransactions') || '[]');

    const sellMonthlyTbody = document.querySelector("#sell-monthly tbody");
    const sellYtdTbody = document.querySelector("#sell-ytd tbody");
    const sellFullTbody = document.querySelector("#sell-full tbody");

    // Clear tables
    sellMonthlyTbody.innerHTML = '';
    sellYtdTbody.innerHTML = '';
    sellFullTbody.innerHTML = '';

    // --- Monthly ---
    const monthlyGroups = {};
    transactions.forEach(t => {
        const key = t.plasticType || 'Unknown';
        if (!monthlyGroups[key]) monthlyGroups[key] = { totalQty: 0, totalPrice: 0, count: 0 };
        monthlyGroups[key].totalQty += t.soldQty;
        monthlyGroups[key].totalPrice += t.soldPriceActual;
        monthlyGroups[key].count++;
    });
    for (const plastic in monthlyGroups) {
        const data = monthlyGroups[plastic];
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${plastic}</td><td>${data.totalQty}</td><td>${(data.totalPrice / data.count).toFixed(2)}</td>`;
        sellMonthlyTbody.appendChild(tr);
    }

    // --- YTD ---
    const currentYear = new Date().getFullYear();
    const ytdGroups = {};
    transactions.forEach(t => {
        const date = new Date(t.sellingDate);
        if (date.getFullYear() !== currentYear) return;
        const month = date.toLocaleString('default', { month: 'short' });
        const key = `${month}-${t.plasticType}`;
        if (!ytdGroups[key]) ytdGroups[key] = { totalQty: 0, totalPrice: 0, count: 0 };
        ytdGroups[key].totalQty += t.soldQty;
        ytdGroups[key].totalPrice += t.soldPriceActual;
        ytdGroups[key].count++;
    });
    for (const key in ytdGroups) {
        const [month, plastic] = key.split('-');
        const data = ytdGroups[key];
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${month}</td><td>${plastic}</td><td>${data.totalQty}</td><td>${(data.totalPrice / data.count).toFixed(2)}</td>`;
        sellYtdTbody.appendChild(tr);
    }

    // --- Full ---
    const fullGroups = {};
    transactions.forEach(t => {
        const date = new Date(t.sellingDate);
        const year = date.getFullYear();
        const month = date.toLocaleString('default', { month: 'short' });
        const key = `${year}-${month}-${t.plasticType}`;
        if (!fullGroups[key]) fullGroups[key] = { totalQty: 0, totalPrice: 0, count: 0 };
        fullGroups[key].totalQty += t.soldQty;
        fullGroups[key].totalPrice += t.soldPriceActual;
        fullGroups[key].count++;
    });
    for (const key in fullGroups) {
        const [year, month, plastic] = key.split('-');
        const data = fullGroups[key];
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${year}</td><td>${month}</td><td>${plastic}</td><td>${data.totalQty}</td><td>${(data.totalPrice / data.count).toFixed(2)}</td>`;
        sellFullTbody.appendChild(tr);
    }
}

// Call renderSellReports when dashboard loads
document.addEventListener('DOMContentLoaded', renderSellReports);

// Optional: update if localStorage changes
window.addEventListener('storage', renderSellReports);

  </script>



<!-- ---------------------------------------------------------------------------------------------------------- -->
